$(function(){function c(t){$("#main-menu").css({top:e()+"px",visibility:"inherit"});t&&$(".main-menu-item a").click(function(){n($(this).attr("data-path"),!1)})}function k(){$("a.modal-link").click(function(){n($(this).attr("data-path"),!1)})}function e(){return $menu=$("#main-menu"),$menu.hasClass("open")?$(".navbar")[0].offsetHeight:-($menu.height()-($(".navbar")[0].offsetHeight-$(".navbar").height()))+(window.innerWidth>768||!$(".navbar-collapse").hasClass("in")?0:i+$(".navbar-header")[0].offsetHeight)}function n(i,r){if(i!==null&&($("#modal").attr("unsaved")==null||confirm("Are you sure you want to leave this page?"))){i[0]!=="_"&&(console.log("Set timeout in 30 seconds"),y=setTimeout(function(){n("_"+i,!1)},3e4));$("#modal").modal("show").attr("unsaved",null).html('<div class="loading-container"><img class="loading" src="/images/Load.gif" width="96px" height="96px" /><\/div>');$("#modal").off("click");i="/"+i;var u=i;u.indexOf("?")>-1&&(u=u.slice(0,u.indexOf("?")));u.lastIndexOf("/")>0&&u.lastIndexOf("/")!=u.indexOf("/",1)&&(u=u.slice(0,u.lastIndexOf("/")));switch(u){case"/Account/Login":t(480,600,r);$("#modal").load(i,d);break;case"/Account/Register":t(800,600,r);$("#modal").load(i,g);break;case"/Account/Settings":t(800,600,r);$("#modal").load(i,nt);break;case"/Question/RelatedQuestions":t(1280,720,r);$("#modal").load(i,it);break;case"/Question/SimilarQuestions":t(1280,720,r);$("#modal").load(i,rt);break;case"/Admin/Moderation":t(1280,720,r);$("#modal").load(i,ft);break;case"/Admin/UserRoles":t(960,720,r);$("#modal").load(i,ut);break;default:u.startsWith("/Mailbox")?(u!="/Mailbox/ReportItem"?t(1280,720,r):t(800,600,r),$("#modal").load(i,tt)):(t(400,240,r),$("#modal").load("/Home/Timeout",et).attr("data-refresh-path",i.slice(i.indexOf("/")+1)))}}}function u(n){console.log("Cancel timeout");window.clearTimeout(y);$("#modal > div#modal-content").children().length>0&&(n&&$("#modal").attr("data-refresh-path",null),$('<span class="close-modal" style="float: right"><i class="fa fa-3x fa-times-circle blue hover-green" data-toggle="modal" data-target="#modal"><\/i><\/span>').appendTo("#modal > div#modal-header > div"),$("#modal").off("click"),p())}function p(){if($("#modal > div#modal-content").children().length>0){var n=($("#modal").attr("toHeight")!=null?$("#modal").attr("toHeight"):$("#modal")[0].offsetHeight)-(parseInt($("#modal").css("padding-top"))+parseInt($("#modal").css("padding-bottom"))+$("#modal > div#modal-header")[0].offsetHeight);$("#modal > div#modal-content").children().length>0&&n<($("#modal").attr("toHeight")!=null?$("#modal").attr("toHeight"):$("#modal")[0].offsetHeight)&&$("#modal > div#modal-content").css("height",n+"px")}}function t(n,t,i){var r=$("#modal").attr("toHeight",t),u=(window.innerHeight-r.attr("toHeight")>>1)+$(".navbar-fixed-top").height(),f=parseInt(r.css("margin-bottom"));u<f&&(u=f);i?r.css({"max-width":n+"px",height:t+"px","margin-top":u+"px"}).attr("toHeight",null):r.animate({"max-width":n+"px",height:t+"px","margin-top":u+"px"},a,"swing",function(){$(this).attr("toHeight",null);p()})}function d(){u(!0);$("#register-link").on("click",function(){n("Account/Register?returnurl="+window.location.pathname.replace(/%20/g,"_"),!1)})}function g(){u(!0);$("#region-form-group").hide();$("#city-form-group").hide();$("#CountryID").on("change",w);$("#RegionID").on("change",b);$("#login-link").on("click",function(){n("Account/Login?returnurl="+window.location.pathname.replace(/%20/g,"_"),!1)})}function nt(){u(!0);$("#CountryID").on("change",w);$("#RegionID").on("change",b)}function tt(){u(!0);window.setTimeout(function(){var n=$(".mailbox-controls")[0].offsetHeight;$(".mailbox-list-table-container").css("height","calc(100% - "+n+"px)")},10);$(".btn-new-message").each(function(){$(this).on("click",function(){$(".mailbox-item-row.open").trigger("click");$(this).prop("disabled",!0);$("#modal .mce-tinymce").remove();$("#mailbox-content-container").addClass("loading").html('<div class="loading-container"><img class="loading" src="/images/Load.gif" width="96px" height="96px" /><\/div>').load("/Mailbox/NewMessage?returnUrl="+$(this).parent().parent().parent().attr("data-return-url"),l)})});$(".mailbox-item-row:not(.mailbox-item-row-empty) > td > div.mailbox-item").on("click",function(){var t=$("#mailbox-content-container").hasClass("loading"),n;t||$("#modal .mce-tinymce").remove();n=$(this).parent().parent();n.hasClass("open")?(n.attr("data-private-message-id")!=null?$(".mailbox-item-row[data-private-message-id="+n.attr("data-private-message-id")+"]").removeClass("open"):n.removeClass("open"),t||$("#mailbox-content-container").html("")):($(".mailbox-item-row.open").removeClass("open"),n.attr("data-private-message-id")!=null?$(".mailbox-item-row[data-private-message-id="+n.attr("data-private-message-id")+"]").addClass("open"):n.addClass("open"),t||($("#mailbox-content-container").addClass("loading").html('<div class="loading-container"><img class="loading" src="/images/Load.gif" width="96px" height="96px" /><\/div>').load("/Mailbox/"+n.attr("data-mailbox-type-id")+"/"+n.attr("data-mailbox-item-id")+"/MailboxItem?returnUrl="+n.parentsUntil("#mailbox-list-container","div.tab-pane").attr("data-return-url"),l),$(".btn-new-message").prop("disabled",!0)))})}function l(){$("#mailbox-content-container").removeClass("loading");$(".btn-new-message").prop("disabled",null);$("#mailbox-content-container .btn-report").click(s);$("#mailbox-content-container .btn-ban").click(h);$(".private-message-link").on("click",function(){$(".mailbox-item-row.open").removeClass("open");$("#mailbox-content-container").addClass("loading").html('<div class="loading-container"><img class="loading" src="/images/Load.gif" width="96px" height="96px" /><\/div>').load("/Mailbox/PrivateMessage?privateMessageID="+$(this).attr("data-private-message-id")+"&returnUrl="+$(this).parentsUntil("div.scroll-div","#mailbox-content-container").attr("data-return-url"),l);$(".btn-new-message").prop("disabled",!0)})}function it(){u(!0)}function rt(){u(!0)}function ut(){u(!0)}function ft(){u(!0);$("#modal .toggle-section").append("&nbsp;").append($(document.createElement("i")).addClass("fa").addClass("fa-compress")).on("click",function(){var n=$(this).parent().find("#"+$(this).attr("data-section-id"));n.toggleClass("section-collapse");n.hasClass("section-collapse")?(n.hide(500),$(this).children("i").removeClass("fa-compress").addClass("fa-expand")):(n.show(500),$(this).children("i").removeClass("fa-expand").addClass("fa-compress"))})}function et(){u(!1);$("#refreshLink").click(function(){n($("#modal").attr("data-refresh-path"),!1)})}function ot(){var n=$("#modal"),t=(window.innerHeight-parseInt(n.css("height"))>>1)+$(".navbar-fixed-top").height(),i=parseInt(n.css("margin-bottom"));t<i&&(t=i);n.animate({"margin-top":t},a,"swing")}function w(){$sel=$("#CountryID :selected");$("#RegionID option:not([value=''])").remove();$sel.is("[value='']")?($("#region-form-group").hide().children("div").children("select").children(":first-child").prop("selected",!0),$("#city-form-group").hide().children("div").children("input").val("")):$.ajax({type:"POST",url:"Account/GetRegions",contentType:"application/x-www-form-urlencoded; charset=utf-8",data:{countryID:$sel.val(),__RequestVerificationToken:$("input[name=__RequestVerificationToken]").val()},dataType:"json",success:function(n){for(var t in n)$("#RegionID").append('<option value="'+n[t][0]+'">'+n[t][1]+"<\/option>");n.length!==0?($("#region-form-group").show(),$("#city-form-group").hide()):($("#region-form-group").hide(),$("#city-form-group").show())},error:function(){alert("Error: Something went wrong retrieving the region list. Please reselect your country to try again")}})}function b(){$("#RegionID :selected").is("[value='']")?$("#city-form-group").hide():$("#city-form-group").show()}function st(){var n=document.createElement("div"),i,t,r;return n.style.visibility="hidden",n.style.width="100px",n.style.msOverflowStyle="scrollbar",document.body.appendChild(n),i=n.offsetWidth,n.style.overflow="scroll",t=document.createElement("div"),t.style.width="100%",n.appendChild(t),r=t.offsetWidth,n.parentNode.removeChild(n),i-r}const a=500,v={"/":["questionGrid"],"Question/RelatedQuestions":["relatedQuestionGrid"],"Question/SimilarQuestions":["similarQuestionGrid"],"/Starred":["starredQuestionGrid"],"/User*":["userPostGrid","userTagGrid"],"/Ranking*":["rankingGrid"],"Admin/Moderation":["userBanGrid","untrustedURLPatternGrid"],"Admin/UserRoles":["userRoleGrid"]};var f,y,i,o=window.innerWidth,r,s,h;$(document).ready(function(){var b,d,a,l,y,p,w;for(f=$("#login-button").length===0,b=Object.keys(v),d=JSON.parse(localStorage.getItem("gridData")),a=0;a<b.length;a++){var u=b[a],g=v[u],t=$("a[href"+(u[u.length-1]=="*"?"^='"+(u=u.slice(0,-1)):"='"+u)+"'], a[data-path^='"+u+"']");if(t.length!=0){for(l={},y=0;y<g.length;y++)p=g[y],d[p]!=null&&(l[p]=d[p]);Object.keys(l).length!=0&&(t.attr("data-path")==null?(w=t.attr("href").indexOf("?")>-1?"&":"?",t.attr("href",t.attr("href")+w+$.param(l))):(w=t.attr("data-path").indexOf("?")>-1?"&":"?",t.attr("data-path",t.attr("data-path")+w+$.param(l))))}}$(window).on("resize",function(){var u,t,n;f&&c(!1);ot();$("#main").css("height",(r=window.innerHeight-$(".navbar")[0].offsetHeight-(window.innerWidth<=768&&$(".navbar-collapse").hasClass("in")&&$("#main-menu").hasClass("open")?$("#main-menu").children()[0].offsetHeight:0))+"px");u=window.innerWidth>768?o<=768:o>768;t=st();f&&(n=window.innerWidth<=768?0:$("#menu-button").offset().left-($("#main-menu")[0].offsetWidth>>1),$("#main-menu").css({left:n+"px","margin-left":n>0?Math.min(window.innerWidth-n-$("#main-menu")[0].offsetWidth-t,20)+"px":"0px"}));$(".navbar-collapse").css("max-width",window.innerWidth<=768?null:window.innerWidth-t+"px");window.innerWidth<=768&&i==null&&(i=parseInt($(".navbar-collapse").css("padding-bottom"))+parseInt($(".navbar-collapse").css("height"))+parseInt($(".navbar-collapse").css("border-width")));u&&(innerWidth>768&&$(".navbar-collapse").trigger("hide.bs.collapse").removeClass("in"),innerWidth<=768&&$("#main-menu").hasClass("open")?$("#menu-button").trigger("click"):$("#main-menu").css("top",e()+"px"),f&&$(".navbar-header").css("min-width","calc(100% - "+Math.max($("ul.navbar-nav")[0].offsetWidth,163)+"px)"));o=window.innerWidth});$(".navbar-collapse").on("show.bs.collapse",function(){r-=i;$("#main").css({"margin-top":i+11+"px",height:r+"px"});f&&$("#main-menu").css("top",e()+"px")}).on("hide.bs.collapse",function(){f&&$("#main-menu").removeClass("open").css("top",e()-i+"px");r+=i;$("#main").css({"margin-top":"11px",height:r+"px"})});if(f){$(".navbar-header").css("min-width","calc(100% - "+Math.max($("ul.navbar-nav")[0].offsetWidth,163)+"px)");$("#logout-button").on("click",function(){return $("#logout-form").submit(),$(this).off("click"),!1});$("#mailbox-button").on("click",function(){n("Mailbox/0?returnurl="+window.location.pathname.replace(/%20/g,"_"),!1)});$("#menu-button").on("click",function(){var u=$menu.hasClass("open"),n,t;$menu=$("#main-menu");$menu.toggleClass("open");$(".navbar-collapse").hasClass("in")&&window.innerWidth<=768&&(n=$menu.children()[0].offsetHeight,t=n+i,u?(r+=n,$("#main").css({"margin-top":i+11+"px",height:r+"px"})):(r-=n,$("#main").css({"margin-top":t+11+"px",height:r+"px"})));c(!1)});$(".btn-private-message").on("click",function(){n("Mailbox/0?recipient="+$(this).attr("data-display-name")+"&returnurl="+window.location.pathname.replace(/%20/g,"_"),!1)});c(!0);k()}else $("#login-button").on("click",function(){n("Account/Login?returnurl="+window.location.pathname.replace(/%20/g,"_"),!1)});$("#modal").data("init")?n($("#modal").data("init"),!0):$(window).trigger("resize");$("#modal").removeData("init");s=function(){n("Mailbox/ReportItem?reportTypeID="+$(this).attr("data-report-type-id")+"&reportedItemID="+$(this).attr("data-reportable-item-id")+"&returnurl="+window.location.pathname.replace(/%20/g,"_"),!1)};h=function(){n("Admin/Moderation?displayName="+$(this).attr("data-display-name"),!1)};$(".btn-report").click(s);$(".btn-ban").click(h)})});